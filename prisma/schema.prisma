generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Define all enums first
enum carriers_status {
  Active
  Inactive
  Suspended
}

enum accounts_receivable_aging_status {
  On_Time
  At_Risk
  Late
}

enum activity_logs_status {
  success
  failure
  pending
}

enum cold_room_inventory_category {
  Fruit
  Vegetable
  Flower
  Other
}

enum cold_room_inventory_unit {
  pallets
  tonnes
  boxes
  crates
}

enum cold_rooms_status {
  Optimal
  Warning
  Alert
}

enum cold_rooms_zone_type {
  Fruit
  Vegetable
  Flower
}

enum customers_status {
  active
  inactive
  new
}

enum dwell_times_status {
  optimal
  moderate
  high
}

enum products_category {
  Fruit
  Vegetable
  Flower
  Other
}

enum quotes_status {
  Draft
  Sent
  Accepted
  Expired
}

enum shipments_status {
  Awaiting_QC
  Processing
  Receiving
  Preparing_for_Dispatch
  Ready_for_Dispatch
  In_Transit
  Delivered
  Delayed
}

enum suppliers_status {
  Active
  Inactive
  Onboarding
}

enum weight_entries_unit {
  kg
  lb
}

enum visitors_status {
  Pre_registered
  Checked_in
  Checked_out
  Pending_Exit
}

// Define models
model carriers {
  id                   String     @id @default(cuid()) @db.VarChar(20)
  name                 String     @unique @db.VarChar(100)
  contact_name         String?    @db.VarChar(100)
  contact_email        String?    @db.VarChar(100)
  contact_phone        String?    @db.VarChar(20)
  rating               Float?     @default(0) @db.Float
  status               carriers_status @default(Active)
  id_number            String?    @db.VarChar(50)
  vehicle_registration String?    @db.VarChar(20)
  created_at           DateTime   @default(now()) @db.DateTime(0)
  updated_at           DateTime   @updatedAt @db.DateTime(0)
  shipments            shipments[]
  
  @@map("carriers")
}

model employees {
  id          String   @id @default(cuid())
  name        String
  email       String
  role        String
  status      String
  performance String?
  rating      Int?
  contract    String?
  salary      String?
  image       String?
  id_number   String?
  phone       String?
  issue_date  DateTime? @db.DateTime(0)
  expiry_date DateTime? @db.DateTime(0)
  company     String?
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @updatedAt @db.DateTime(0)
  
  attendance  attendance[]
  // Note: visitors relationship is commented out since Visitor model doesn't exist
  // visitors    visitors[]
  
  @@map("employees")
}

model accounts_receivable {
  id           String                           @id @default(cuid()) @db.VarChar(20)
  customer_id  String?                          @db.VarChar(20)
  invoice_id   String?                          @db.VarChar(100)
  amount       Float?                           @db.Decimal(12, 2)
  due_date     DateTime?                        @db.Date
  aging_status accounts_receivable_aging_status
  created_at   DateTime                         @default(now()) @db.DateTime(0)
  
  customers    customers?                       @relation(fields: [customer_id], references: [id], onDelete: Restrict, onUpdate: Restrict)
  
  @@index([customer_id], name: "customer_id_idx")
  @@map("accounts_receivable")
}

model activity_logs {
  id         String               @id @default(cuid()) @db.VarChar(20)
  user       String?              @db.VarChar(100)
  avatar     String?              @db.VarChar(255)
  action     String?              @db.Text
  ip         String?              @db.VarChar(45)
  timestamp  DateTime?            @db.DateTime(0)
  status     activity_logs_status
  created_at DateTime             @default(now()) @db.DateTime(0)
  
  @@map("activity_logs")
}

model anomalies {
  id                 Int      @id @default(autoincrement())
  metric_name        String?  @db.VarChar(100)
  metric_value       Float?   @db.Decimal(10, 2)
  expected_value     Float?   @db.Decimal(10, 2)
  timestamp          DateTime? @db.DateTime(0)
  additional_context String?  @db.Text
  created_at         DateTime @default(now()) @db.DateTime(0)
  
  @@map("anomalies")
}

model cold_room_inventory {
  id                String                       @id @default(cuid()) @db.VarChar(20)
  product           String                       @db.VarChar(100)
  category          cold_room_inventory_category
  quantity          Int?
  unit              cold_room_inventory_unit
  location          String?                      @db.VarChar(100)
  entry_date        DateTime?                    @db.DateTime(0)
  current_weight    Float?                       @db.Decimal(10, 2)
  reorder_threshold Float?                       @db.Decimal(10, 2)
  created_at        DateTime                     @default(now()) @db.DateTime(0)
  
  @@map("cold_room_inventory")
}

model cold_rooms {
  id          String                @id @default(cuid()) @db.VarChar(20)
  name        String                @db.VarChar(100)
  temperature Float?                @db.Decimal(4, 1)
  humidity    Float?                @db.Decimal(4, 1)
  status      cold_rooms_status
  zone_type   cold_rooms_zone_type?
  created_at  DateTime              @default(now()) @db.DateTime(0)
  
  @@map("cold_rooms")
}

model customer_contacts {
  id          Int        @id @default(autoincrement())
  customer_id String?    @db.VarChar(20)
  name        String     @db.VarChar(100)
  role        String?    @db.VarChar(100)
  email       String?    @db.VarChar(100)
  phone       String?    @db.VarChar(20)
  is_primary  Boolean?   @default(false)
  
  customers   customers? @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: Restrict)
  
  @@index([customer_id], name: "customer_id_idx")
  @@map("customer_contacts")
}

model customers {
  id                  String                @id @default(cuid()) @db.VarChar(20)
  name                String                @db.VarChar(100)
  location            String?               @db.VarChar(100)
  tags                String?               @db.LongText
  logo_url            String?               @db.VarChar(255)
  website             String?               @db.VarChar(100)
  ytd_sales           Float?                @db.Decimal(12, 2)
  last_order          DateTime?             @db.Date
  status              customers_status
  outstanding_balance Float?                @default(0.00) @db.Decimal(12, 2)
  open_invoices       Int?                  @default(0)
  created_at          DateTime              @default(now()) @db.DateTime(0)
  
  accounts_receivable accounts_receivable[]
  customer_contacts   customer_contacts[]
  quotes              quotes[]
  shipments           shipments[]
  
  @@map("customers")
}

model dwell_times {
  id              String             @id @default(cuid()) @db.VarChar(20)
  location        String?            @db.VarChar(100)
  primary_product String?            @db.VarChar(100)
  avg_dwell_time  String?            @db.VarChar(50)
  items           Int?
  status          dwell_times_status
  next_action     String?            @db.Text
  entry_date      DateTime?          @db.DateTime(0)
  weight          Float?             @db.Decimal(10, 2)
  created_at      DateTime           @default(now()) @db.DateTime(0)
  
  @@map("dwell_times")
}

model products {
  id           String            @id @default(cuid()) @db.VarChar(20)
  name         String            @db.VarChar(100)
  variety      String?           @db.VarChar(100)
  storage_temp Float?            @db.Decimal(4, 1)
  category     products_category
  created_at   DateTime          @default(now()) @db.DateTime(0)
  
  @@map("products")
}

model quotes {
  id          String        @id @default(cuid()) @db.VarChar(20)
  quote_id    String?       @unique @db.VarChar(100)
  customer_id String?       @db.VarChar(20)
  date        DateTime?     @db.Date
  valid_until DateTime?     @db.Date
  amount      Float?        @db.Decimal(12, 2)
  status      quotes_status
  created_at  DateTime      @default(now()) @db.DateTime(0)
  
  customers   customers?    @relation(fields: [customer_id], references: [id], onDelete: Restrict, onUpdate: Restrict)
  
  @@index([customer_id], name: "customer_id_idx")
  @@map("quotes")
}

model shipments {
  id               String           @id @default(cuid()) @db.VarChar(20)
  shipment_id      String           @unique @db.VarChar(50)
  customer_id      String?          @db.VarChar(20)
  origin           String?          @db.VarChar(100)
  destination      String?          @db.VarChar(100)
  status           shipments_status
  product          String?          @db.VarChar(100)
  tags             String?          @db.VarChar(100)
  weight           String?          @db.VarChar(50)
  carrier          String?          @db.VarChar(100)
  carrier_id       String?          @db.VarChar(20)
  expected_arrival DateTime?        @db.DateTime(0)
  created_at       DateTime         @default(now()) @db.DateTime(0)
  
  quality_checks   quality_checks[]
  carriers         carriers?        @relation(fields: [carrier_id], references: [id])
  customers        customers?       @relation(fields: [customer_id], references: [id])
  
  @@index([customer_id], name: "customer_id_idx")
  @@index([carrier_id], name: "carrier_id_idx")
  @@map("shipments")
}

model suppliers {
  id                   String           @id @default(cuid()) @db.VarChar(20)
  name                 String           @db.VarChar(100)
  location             String?          @db.VarChar(100)
  contact_name         String?          @db.VarChar(100)
  contact_email        String?          @db.VarChar(100)
  contact_phone        String?          @db.VarChar(20)
  produce_types        String?          @db.LongText
  status               suppliers_status
  logo_url             String?          @db.VarChar(255)
  active_contracts     Int?             @default(0)
  kra_pin              String?          @db.VarChar(20)
  supplier_code        String?          @unique @db.VarChar(20)
  vehicle_number_plate String?          @db.VarChar(20)
  driver_name          String?          @db.VarChar(100)
  driver_id_number     String?          @db.VarChar(50)
  mpesa_paybill        String?          @db.VarChar(20)
  mpesa_account_number String?          @db.VarChar(50)
  bank_name            String?          @db.VarChar(100)
  bank_account_number  String?          @db.VarChar(50)
  password             String?          @db.VarChar(255)
  created_at           DateTime         @default(now()) @db.DateTime(0)
  
  @@map("suppliers")
}

model visitors {
  id                    String   @id @default(cuid())
  visitor_code          String   @unique
  name                  String
  id_number             String?
  company               String?
  email                 String?
  phone                 String
  vehicle_plate         String?
  vehicle_type          String?
  cargo_description     String?
  visitor_type          String?  @default("visitor")
  status                String?  @default("Pre-registered")
  check_in_time         DateTime?
  check_out_time        DateTime?
  expected_check_in_time DateTime?
  host_id               String?
  department            String?
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
  
  @@map("visitors")
}

model weight_entries {
  id              String   @id @default(cuid()) @db.VarChar(20)
  pallet_id       String?  @db.VarChar(100)
  product         String?  @db.VarChar(100)
  weight          Float?   @db.Decimal(10, 2)
  unit            weight_entries_unit
  timestamp       DateTime? @db.DateTime(0)
  supplier        String?  @db.VarChar(100)
  truck_id        String?  @db.VarChar(100)
  driver_id       String?  @db.VarChar(100)
  gross_weight    Float?   @db.Decimal(10, 2)
  tare_weight     Float?   @db.Decimal(10, 2)
  net_weight      Float?   @db.Decimal(10, 2)
  declared_weight Float?   @db.Decimal(10, 2)
  rejected_weight Float?   @db.Decimal(10, 2)
  created_at      DateTime @default(now()) @db.DateTime(0)
  
  @@map("weight_entries")
}

model quality_checks {
  id                  String   @id @default(cuid()) @db.VarChar(20)
  shipment_id         String?  @db.VarChar(20)
  operator_id         String?  @db.VarChar(20)
  pallet_id           String?  @db.VarChar(100)
  product             String?  @db.VarChar(100)
  declared_weight     Float?   @db.Decimal(10, 2)
  net_weight          Float?   @db.Decimal(10, 2)
  rejected_weight     Float?   @db.Decimal(10, 2)
  accepted_weight     Float?   @db.Decimal(10, 2)
  arrival_temperature Float?   @db.Decimal(4, 1)
  driver_id           String?  @db.VarChar(100)
  truck_id            String?  @db.VarChar(100)
  packaging_status    String?  @default("accepted") @db.VarChar(50)
  freshness_status    String?  @default("accepted") @db.VarChar(50)
  seals_status        String?  @default("accepted") @db.VarChar(50)
  overall_status      String?  @default("approved") @db.VarChar(50)
  notes               String?  @db.Text
  processed_at        DateTime @default(now()) @db.DateTime(0)
  processed_by        String   @db.VarChar(100)
  created_at          DateTime @default(now()) @db.DateTime(0)
  
  shipments           shipments? @relation(fields: [shipment_id], references: [id])
  
  @@index([shipment_id], name: "shipment_id_idx")
  @@map("quality_checks")
}

model attendance {
  id            String   @id @default(cuid())
  employeeId    String
  date          DateTime
  status        String
  clockInTime   DateTime?
  clockOutTime  DateTime?
  designation   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  employee      employees @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  @@unique([employeeId, date])
  @@map("attendance")
}